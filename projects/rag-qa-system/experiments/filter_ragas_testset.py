# Generated by Claude Code
"""Create filtered copy of ragas_testset.jsonl without low-quality questions."""
import json
from pathlib import Path

PROJECT_ROOT = Path(__file__).parent.parent
EVAL_DATA_DIR = PROJECT_ROOT / "data" / "eval"

RAGAS_TESTSET_PATH = EVAL_DATA_DIR / "ragas_testset.jsonl"
FILTERED_TESTSET_PATH = EVAL_DATA_DIR / "ragas_testset_filtered.jsonl"

# Questions to remove (13 low-quality questions)
REMOVE_INDICES = [4, 5, 14, 15, 18, 21, 22, 24, 25, 28, 35, 37, 39]

print(f"Filtering ragas_testset.jsonl...")
print(f"Removing {len(REMOVE_INDICES)} low-quality questions: {REMOVE_INDICES}\n")

# Load original testset
with open(RAGAS_TESTSET_PATH, 'r') as f:
    questions = [json.loads(line) for line in f]

print(f"Original testset: {len(questions)} questions")

# Filter out bad questions
filtered_questions = [q for i, q in enumerate(questions) if i not in REMOVE_INDICES]

print(f"Filtered testset: {len(filtered_questions)} questions")
print(f"Removed: {len(questions) - len(filtered_questions)} questions\n")

# Save filtered testset
with open(FILTERED_TESTSET_PATH, 'w') as f:
    for question in filtered_questions:
        f.write(json.dumps(question) + '\n')

print(f"Filtered testset saved to: {FILTERED_TESTSET_PATH}")

# Print summary of what was removed
print("\n" + "="*80)
print("Removed Questions Summary:")
print("="*80)

removed_questions = [q for i, q in enumerate(questions) if i in REMOVE_INDICES]
for i, q in zip(REMOVE_INDICES, removed_questions):
    query = q.get('user_input', '')
    query_style = q.get('query_style', '')
    query_length = q.get('query_length', '')
    print(f"\n[{i}] ({query_style}, {query_length})")
    print(f"  {query[:100]}{'...' if len(query) > 100 else ''}")
